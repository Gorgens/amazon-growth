---
title: "Resultados"
output: html_document
---

```{r pacotes3}
require(tidyverse)
require(magrittr)
require(reshape2)
require(ggplot2)
require(V.PhyloMaker)
require(phytools)
require(rstanarm)
require(bayesplot)
```
Frequência de indivíduos por grupo ecológico...

```{r proporcaoGruposEcologicos, echo=FALSE}
arvHaEspecie = invMerged %>%
  drop_na(GrupoEco) %>%
  filter(DBH >= 10) %>%
  group_by(area, plot, subplot, year, GrupoEco) %>% 
  summarise(ntree = sum(eqTree)) %>%
  drop_na(ntree) %>%
  group_by(area, plot, subplot, GrupoEco) %>%
  summarise(ntree = mean(ntree)) %>%
  group_by(area, GrupoEco) %>%
  summarise(ntree = sum(ntree)) %>%
  left_join(parcelasArea) %>%
  mutate(arvha = ntree / nplots) %>%
  group_by(GrupoEco) %>%
  summarise(arvha = mean(arvha)) %>%
  filter(GrupoEco != "OUTROS") %>%
  mutate(arvProp = arvha / sum(arvha) * 100)

arvHaEspecie
```

Incremento pelo grupo ecológico...

```{r mediaIncrementoGruposEcologicos, echo=FALSE}
incrementoGrupo = incEco %>%
  filter(GrupoEco != "OUTROS") %>%
  group_by(GrupoEco) %>%
  summarise(incDesv = IQR(rInc, na.rm = TRUE), 
            rInc = median(rInc))

incrementoGrupo
```


```{r estaticaGrupoEcologico, echo=FALSE}
incGrupoEco <- stan_glm(
  rInc ~ GrupoEco,
  data = incEco,
  family = Gamma(link="log"))
```

```{r}
bayesplot::color_scheme_set("viridis")
plot(incGrupoEco, plotfun = "areas", prob = 0.9, regex_pars = c("(Intercept)", "Grupo"))
```

```{r}
grupo = "Pioneer"

grupoEcologico = invMerged %>%
  filter(GrupoEco == grupo)

numeroArvores = invMerged %>%
  filter(GrupoEco == grupo) %>%
  filter(DBH >= 10) %>%
  group_by(area, plot, subplot, year, cc) %>% 
  summarise(ntree = sum(eqTree))  %>%
  drop_na(ntree) %>%
  group_by(area, cc) %>%
  summarise(narv = sum(ntree)) %>%
  left_join(parcelasArea) %>%
  mutate(arvha = narv / nplots) %>%
  group_by(cc) %>%
  summarise(arvha = mean(arvha))

ggplot(numeroArvores, aes(cc, arvha)) + geom_col() +
  xlab('Diameter distribution') + ylab('Trees per hectare') +
  ggtitle(paste0(grupo)) + 
  theme_bw() + theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     panel.background = element_blank(),
                     axis.line = element_line(colour = "black"))
```

```{r}
grupo = "Light-demanding"

grupoEcologico = invMerged %>%
  filter(GrupoEco == grupo)

numeroArvores = invMerged %>%
  filter(GrupoEco == grupo) %>%
  filter(DBH >= 10) %>%
  group_by(area, plot, subplot, year, cc) %>% 
  summarise(ntree = sum(eqTree))  %>%
  drop_na(ntree) %>%
  group_by(area, cc) %>%
  summarise(narv = sum(ntree)) %>%
  left_join(parcelasArea) %>%
  mutate(arvha = narv / nplots) %>%
  group_by(cc) %>%
  summarise(arvha = mean(arvha))

ggplot(numeroArvores, aes(cc, arvha)) + geom_col() +
  xlab('Diameter distribution') + ylab('Trees per hectare') +
  ggtitle(paste0(grupo)) + 
  theme_bw() + theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     panel.background = element_blank(),
                     axis.line = element_line(colour = "black"))
```

```{r}
grupo = "Intermediate"

grupoEcologico = invMerged %>%
  filter(GrupoEco == grupo)

numeroArvores = invMerged %>%
  filter(GrupoEco == grupo) %>%
  filter(DBH >= 10) %>%
  group_by(area, plot, subplot, year, cc) %>% 
  summarise(ntree = sum(eqTree))  %>%
  drop_na(ntree) %>%
  group_by(area, cc) %>%
  summarise(narv = sum(ntree)) %>%
  left_join(parcelasArea) %>%
  mutate(arvha = narv / nplots) %>%
  group_by(cc) %>%
  summarise(arvha = mean(arvha))

ggplot(numeroArvores, aes(cc, arvha)) + geom_col() +
  xlab('Diameter distribution') + ylab('Trees per hectare') +
  ggtitle(paste0(grupo)) + 
  theme_bw() + theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     panel.background = element_blank(),
                     axis.line = element_line(colour = "black"))
```

```{r}
grupo = "Shade-tolerant"

grupoEcologico = invMerged %>%
  filter(GrupoEco == grupo)

numeroArvores = invMerged %>%
  filter(GrupoEco == grupo) %>%
  filter(DBH >= 10) %>%
  group_by(area, plot, subplot, year, cc) %>% 
  summarise(ntree = sum(eqTree))  %>%
  drop_na(ntree) %>%
  group_by(area, cc) %>%
  summarise(narv = sum(ntree)) %>%
  left_join(parcelasArea) %>%
  mutate(arvha = narv / nplots) %>%
  group_by(cc) %>%
  summarise(arvha = mean(arvha))

ggplot(numeroArvores, aes(cc, arvha)) + geom_col() +
  xlab('Diameter distribution') + ylab('Trees per hectare') +
  ggtitle(paste0(grupo)) + 
  theme_bw() + theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     panel.background = element_blank(),
                     axis.line = element_line(colour = "black"))
```

```{r}
grupo = "Emergent"

grupoEcologico = invMerged %>%
  filter(GrupoEco == grupo)

numeroArvores = invMerged %>%
  filter(GrupoEco == grupo) %>%
  filter(DBH >= 10) %>%
  group_by(area, plot, subplot, year, cc) %>% 
  summarise(ntree = sum(eqTree))  %>%
  drop_na(ntree) %>%
  group_by(area, cc) %>%
  summarise(narv = sum(ntree)) %>%
  left_join(parcelasArea) %>%
  mutate(arvha = narv / nplots) %>%
  group_by(cc) %>%
  summarise(arvha = mean(arvha))

ggplot(numeroArvores, aes(cc, arvha)) + geom_col() +
  xlab('Diameter distribution') + ylab('Trees per hectare') +
  ggtitle(paste0(grupo)) + 
  theme_bw() + theme(panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(),
                     panel.background = element_blank(),
                     axis.line = element_line(colour = "black"))
```

```{r}
modelingCC = invMerged %>%
  filter(GrupoEco != "OUTROS") %>%
  filter(DBH >= 10) %>%
  group_by(area, plot, subplot, year, GrupoEco, cc) %>% 
  summarise(ntree = sum(eqTree))  %>%
  group_by(area, plot, year, GrupoEco, cc) %>%
  summarise(ntree = mean(ntree)) %>%
  group_by(area, year, GrupoEco, cc) %>%
  summarise(ntree = mean(ntree))

modelingCC$cc
```


```{r ddGrupoEcologico, echo=FALSE}
incGrupoEco <- stan_glm(
  log(n) ~ cc / GrupoEco,
  data = modelingCC,
  family = gaussian(link = 'identity'))
```